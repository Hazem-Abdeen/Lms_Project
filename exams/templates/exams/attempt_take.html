{% extends "courses/base.html" %}
{% load exam_extras %}

{% block title %}Take Exam{% endblock %}
{% block topbar_left %}Take Exam{% endblock %}

{% block content %}
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h3 class="mb-0">{{ exam.title }}</h3>
      <div class="text-muted small">
        Attempt #{{ attempt.id }} • Current Mark: {{ attempt.user_mark }}/{{ attempt.full_mark }}
      </div>
    </div>
    <a class="btn btn-outline-secondary" href="{% url 'exams:exam_detail' exam.id %}">Back</a>
  </div>

  <form method="post" class="card">
    {% csrf_token %}
    <div class="card-body">
      {% for q in questions %}
        <div class="mb-4">
          <div class="fw-semibold mb-2">
            Q{{ q.order }} — {{ q.mark }} marks
          </div>
          <div class="text-muted mb-2">{{ q.text }}</div>

          {% for c in q.choices.all %}
            <div class="form-check">
              <input class="form-check-input"
                     type="radio"
                     name="q_{{ q.id }}"
                     id="q{{ q.id }}_c{{ c.id }}"
                     value="{{ c.id }}"
                     {% if answers_map.q.id == c.id %}checked{% endif %}>
              <label class="form-check-label" for="q{{ q.id }}_c{{ c.id }}">
                {{ c.text }}
              </label>
            </div>
          {% empty %}
            <div class="text-muted small">No answers added yet for this question.</div>
          {% endfor %}
        </div>
        <hr>
      {% endfor %}

      <div class="d-flex gap-2 justify-content-end">
        <button type="submit" class="btn btn-primary">Save Answers</button>
        {# Step 4: Submit button will go here #}
      </div>
    </div>
  </form>
{% endblock %}
